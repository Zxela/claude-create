name: review-approve-valid
description: "Verify reviewer approves implementation that meets all acceptance criteria"
workflow: homerun:review
tags: [review, approval, smoke, homerun]
timeout_seconds: 300
isolation: tempdir

fixtures:
  - path: src/validators.ts
    content: |
      export function isPositive(n: number): boolean {
        return n > 0;
      }
  - path: tests/validators.test.ts
    content: |
      import { isPositive } from '../src/validators';

      describe('isPositive', () => {
        it('returns true for positive numbers', () => {
          expect(isPositive(5)).toBe(true);
          expect(isPositive(100)).toBe(true);
        });

        it('returns false for zero and negatives', () => {
          expect(isPositive(0)).toBe(false);
          expect(isPositive(-1)).toBe(false);
        });
      });

input:
  prompt: |
    Review this implementation for task 001.

    Task spec:
    {
      "id": "001",
      "title": "Add number validation",
      "acceptance_criteria": [
        {
          "id": "AC-001",
          "criterion": "isPositive returns true for positive numbers",
          "test_assertion": "expect(isPositive(5)).toBe(true)"
        },
        {
          "id": "AC-002",
          "criterion": "isPositive returns false for zero and negatives",
          "test_assertion": "expect(isPositive(-1)).toBe(false)"
        }
      ]
    }

    The implementation files are already on disk:
    - src/validators.ts — contains the isPositive function
    - tests/validators.test.ts — contains the test suite

    Both acceptance criteria have passing tests. The implementation is correct and complete.
    Please review and output your verdict as a JSON signal.

evaluations:
  - type: behavioral
    checks:
      # Verify approval signal
      - signal_has:
          field: "signal"
          pattern: "APPROVED"

  - type: llm_judge
    model: haiku
    max_tokens: 400
    rubric: |
      Evaluate the quality of the review (signal correctness already checked by behavioral):

      1. AC verification thoroughness (0-4): Explicitly verifies both AC-001 and AC-002 with specific evidence from code
      2. Review reasoning quality (0-3): Explains why the implementation is correct, references actual code/test logic
      3. Completeness of feedback (0-3): Provides useful summary that would help the developer understand the verdict

      If REJECTED when should approve: Score 0

      Score 0-10. Pass threshold: 7
    passing_score: 7
