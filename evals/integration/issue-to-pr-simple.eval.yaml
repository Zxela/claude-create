name: issue-to-pr-simple
description: "Fix a simple GitHub issue end-to-end (SWE-bench style)"
workflow: homerun:create
tags: [integration, swe-bench-style, smoke, homerun]
timeout_seconds: 900

input:
  repo: "${FIXTURES_DIR}/sample-repo"
  issue:
    title: "TypeError in validateUser when input is null"
    body: |
      ## Bug Description
      When calling `validateUser()` with null, it crashes instead of returning false.

      ## Steps to reproduce
      1. Call `validateUser(null)`
      2. Observe TypeError: Cannot read properties of null (reading 'email')

      ## Expected behavior
      Returns `false` for null/undefined input

      ## Actual behavior
      Throws TypeError

      ## Environment
      Node.js 20.x

fixtures:
  - source: sample-repo/
    target: ${TEMP_DIR}/repo/

evaluations:
  - type: behavioral
    checks:
      # Verify workflow completed
      - signal_has:
          field: "signal"
          pattern: "WORKFLOW_COMPLETE|IMPLEMENTATION_COMPLETE"
      # Check output mentions the fix
      - output_contains: "validateUser|null"
      - output_contains: "fix|test"

  - type: llm_judge
    model: haiku
    max_tokens: 500
    rubric: |
      Evaluate the bug fix quality:

      1. Handles null input (0-3): validateUser(null) no longer crashes
      2. Returns false for null (0-2): Correct return value
      3. Doesn't break existing behavior (0-2): Valid emails still work
      4. Has test coverage (0-2): Test added for null case
      5. Clean, minimal change (0-1): Only fixes the bug, no over-engineering

      Score 0-10. Pass threshold: 6
    passing_score: 6
