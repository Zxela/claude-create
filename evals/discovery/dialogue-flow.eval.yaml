name: discovery-dialogue-flow
description: "Verify discovery skill asks structured questions across all 5 categories"
workflow: homerun:discovery
tags: [discovery, dialogue, smoke, homerun]
timeout_seconds: 600

input:
  prompt: |
    I want to build a simple task management CLI tool.
    Users should be able to add, list, and complete tasks.
  responses:
    - "The purpose is a personal productivity tool to track daily to-do items from the terminal. It solves the problem of needing a quick, lightweight task tracker without leaving the command line."
    - "Target users are developers and terminal power users who prefer CLI workflows over GUI apps."
    - "Core features: add task with description, list all tasks with status, mark task as complete, delete a task. Non-goals: team collaboration, cloud sync, recurring tasks."
    - "Must be a Node.js CLI, store tasks in a local JSON file, no external dependencies beyond the standard library. Should work on macOS and Linux. No time constraints."
    - "Handle duplicate task names gracefully, handle empty task list display, handle invalid task IDs when completing or deleting, limit task description length to 500 characters."

evaluations:
  - type: behavioral
    checks:
      - output_contains: "[Tt]ask|[Tt]odo|CLI"
  - type: llm_judge
    model: haiku
    max_tokens: 400
    rubric: |
      Evaluate the discovery dialogue for structured requirements gathering.
      The output should show a multi-turn conversation where the skill asks
      questions to gather requirements.

      1. Asks questions about the feature (0-3): At least 2 distinct questions about what to build
      2. Captures requirements from responses (0-3): Shows understanding of user answers and builds on them
      3. Covers multiple categories (0-2): Touches on at least 2 of: purpose, users, scope, constraints, edge cases
      4. Structured approach (0-2): Questions are organized rather than random

      Note: Discovery asks one question at a time. With only 5 scripted responses,
      the dialogue may not cover all 5 categories. Score based on quality of covered categories.

      Score 0-10. Pass threshold: 5
    passing_score: 5
