name: conductor-parallel-spawn
description: "Verify conductor identifies independent tasks for parallel execution"
workflow: homerun:conductor
tags: [conductor, parallel, smoke, homerun]
timeout_seconds: 600

input:
  prompt: |
    You are the conductor orchestrating implementation. Analyze these tasks and
    describe your execution plan, identifying which tasks can run in parallel.

    Tasks:
    {
      "tasks": [
        {"id": "001", "title": "Setup config", "depends_on": [], "model": "haiku", "status": "pending"},
        {"id": "002", "title": "Add utils", "depends_on": [], "model": "haiku", "status": "pending"},
        {"id": "003", "title": "Add helpers", "depends_on": [], "model": "haiku", "status": "pending"},
        {"id": "004", "title": "Create main", "depends_on": ["001", "002", "003"], "model": "sonnet", "status": "pending"}
      ]
    }

    Tasks 001, 002, 003 have no dependencies and should be spawned in parallel.
    Task 004 depends on all three and must wait until they complete.

    Describe your orchestration plan, then begin executing. Spawn the ready tasks.

evaluations:
  - type: behavioral
    checks:
      # Check output mentions parallel execution strategy
      - output_contains: "001"
      - output_contains: "002"
      - output_contains: "003"

  - type: llm_judge
    model: haiku
    max_tokens: 400
    rubric: |
      Evaluate the conductor's orchestration plan:

      1. Identifies ready tasks (0-3): Recognizes 001, 002, 003 as ready (no deps)
      2. Plans parallel execution (0-4): States these tasks can/should run concurrently
      3. Respects dependencies (0-3): Notes task 004 must wait until 001-003 complete

      Score 0-10. Pass threshold: 6
    passing_score: 6
