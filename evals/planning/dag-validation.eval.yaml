name: planning-dag-validation
description: "Verify planning produces valid DAG with no circular dependencies"
workflow: homerun:planning
tags: [planning, dag, homerun]
timeout_seconds: 300

input:
  prompt: |
    Plan a simple CRUD API with these stories:
    - US-001: Create items
    - US-002: Read items
    - US-003: Update items
    - US-004: Delete items

    All operations require a database model first.

evaluations:
  - type: behavioral
    checks:
      # Verify signal and DAG validation
      - signal_has:
          field: "signal"
          pattern: "PLANNING_COMPLETE"
      - signal_has:
          field: "payload.dependency_graph_valid"
          pattern: "true"
      - output_contains: "depends_on"

  - type: llm_judge
    model: haiku
    max_tokens: 400
    rubric: |
      Evaluate dependency graph quality (DAG validity already checked by behavioral):

      1. Dependency reasoning (0-4): Each dependency makes logical sense (model before service, schema before model)
      2. Parallelism opportunities (0-3): Independent tasks are not unnecessarily serialized
      3. Foundation-first ordering (0-3): Setup/infrastructure tasks are correctly placed before feature tasks

      Score 0-10. Pass threshold: 7
    passing_score: 7
